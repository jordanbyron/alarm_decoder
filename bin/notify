#!/usr/bin/env ruby

require_relative '../lib/alarm_decoder'
require 'prowl'

notified = false

AlarmDecoder.watch do |status|
  if status["ALARM SOUNDING"] || status["FIRE"]
    type = status["FIRE"] ? "Fire" : "Alarm"
    zone = status["zone_name"]
    Prowl.add(
      :apikey => ENV['PROWL_API_KEY'],
      :application => "House Security",
      :event => type,
      :description => zone,
      :priority => 2
    ) unless notified
    notified = true
  else
    notified = false
  end
end
