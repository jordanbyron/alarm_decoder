#!/usr/bin/env ruby

require_relative '../lib/alarm_decoder/alarm_notification'
require_relative '../lib/alarm_decoder/zone_fault_notification'

Mail.defaults do
  delivery_method :smtp,
    address:              ENV['SMTP_ADDRESS'],
    user_name:            ENV['SMTP_USERNAME'],
    password:             ENV['SMTP_PASSWORD'],
    domain:               ENV['SMTP_DOMAIN'],
    authentication:       ENV['SMTP_AUTHENTICATION'],
    port:                 ENV['SMTP_PORT'],
    openssl_verify_mode:  ENV['SMTP_SSL_VERIFY_MODE']
end

AlarmDecoder.watch do |status|
  AlarmDecoder::AlarmNotification.new(status).run
  AlarmDecoder::ZoneFaultNotification.new(status).run
end
