#!/usr/bin/env ruby

require_relative '../lib/alarm_decoder'
require 'optparse'

optparse = OptionParser.new do |opts|
  opts.banner = "Usage: listen [options] port"

  opts.on( '-c', '--configuration_file', 'Configuration file', String,
    'YAML configuration file with zone names. Optional') do |file|
    AlarmDecoder.config = YAML.load_file(file)
  end

  AlarmDecoder.config["baud"] ||= 8

  opts.on( '-b', '--baud [RATE]', 'Baud rate', Integer,
    'Baud rate for serial connection. Default 8' ) do |rate|
    AlarmDecoder.config["baud"] = baud
  end

  opts.on( '-h', '--help', 'Display this screen' ) do
    puts opts
    exit
  end
end

optparse.parse!

AlarmDecoder.config["port"] ||= ARGV.first.to_i unless ARGV.first.nil?

unless AlarmDecoder.config["port"]
  puts "'port' required. Run listen -h for usage guide"
  exit
end

AlarmDecoder.listen
